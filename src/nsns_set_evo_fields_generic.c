/*
  These C codes generated by Cpi version 3.0
  Copyright (C) 2019-2023 Alireza Rashti.
*/


#include "nsns_header.h"


#define add_alloc_get_field(name) ADD_FIELD(name) REALLOC_v_WRITE_v(name)


#define add_alloc_field(name) ADD_AND_ALLOC_FIELD(name) 


#define reav_v_if_exists(name) const double *name = 0; \
 if (_Ind(#name) >= 0) name = patch->fields[Ind(#name)]->v;


void nsns_set_evo_fields_generic(Grid_T *const grid);
void nsns_set_evo_fields_generic(Grid_T *const grid)
{
  Uint p;
  const Uint np = grid->np;

  OpenMP_Patch_Pragma(omp parallel for)
  for (p = 0; p < np; ++p)
  {
  Patch_T *patch = grid->patch[p];

  add_alloc_get_field(evo_grhd_v_U0)
  add_alloc_get_field(evo_grhd_v_U1)
  add_alloc_get_field(evo_grhd_v_U2)
  add_alloc_get_field(evo_grhd_rho)
  add_alloc_get_field(evo_grhd_p)
  add_alloc_get_field(evo_grhd_epsl)
  add_alloc_get_field(evo_alpha)
  add_alloc_get_field(evo_beta_U0)
  add_alloc_get_field(evo_beta_U1)
  add_alloc_get_field(evo_beta_U2)
  add_alloc_get_field(evo_adm_g_D0D0)
  add_alloc_get_field(evo_adm_g_D0D1)
  add_alloc_get_field(evo_adm_g_D0D2)
  add_alloc_get_field(evo_adm_g_D1D1)
  add_alloc_get_field(evo_adm_g_D1D2)
  add_alloc_get_field(evo_adm_g_D2D2)
  add_alloc_get_field(evo_adm_Kij_D0D0)
  add_alloc_get_field(evo_adm_Kij_D0D1)
  add_alloc_get_field(evo_adm_Kij_D0D2)
  add_alloc_get_field(evo_adm_Kij_D1D1)
  add_alloc_get_field(evo_adm_Kij_D1D2)
  add_alloc_get_field(evo_adm_Kij_D2D2)
  READ_v(gConf_D0D0)
  READ_v(gConf_D0D1)
  READ_v(gConf_D0D2)
  READ_v(gConf_D1D1)
  READ_v(gConf_D1D2)
  READ_v(gConf_D2D2)
  READ_v(igConf_U0U0)
  READ_v(igConf_U0U1)
  READ_v(igConf_U0U2)
  READ_v(igConf_U1U1)
  READ_v(igConf_U1U2)
  READ_v(igConf_U2U2)
  READ_v(adm_Kij_D0D0)
  READ_v(adm_Kij_D0D1)
  READ_v(adm_Kij_D0D2)
  READ_v(adm_Kij_D1D1)
  READ_v(adm_Kij_D1D2)
  READ_v(adm_Kij_D2D2)
  READ_v(beta_U0)
  READ_v(beta_U1)
  READ_v(beta_U2)
  READ_v(psi)
  READ_v(alphaPsi)
  reav_v_if_exists(enthalpy)
  reav_v_if_exists(W_U0)
  reav_v_if_exists(W_U1)
  reav_v_if_exists(W_U2)
  reav_v_if_exists(dphi_D0)
  reav_v_if_exists(dphi_D1)
  reav_v_if_exists(dphi_D2)
  reav_v_if_exists(u0)
  FOR_ALL_ijk
  {
  double psi4 =
pow(psi[ijk], 4);

   evo_alpha[ijk] = alphaPsi[ijk]/psi[ijk];
   evo_beta_U0[ijk] = beta_U0[ijk];
   evo_beta_U1[ijk] = beta_U1[ijk];
   evo_beta_U2[ijk] = beta_U2[ijk];
   double adm_g_D0D0 =
gConf_D0D0[ijk]*psi4;

   double adm_g_D0D1 =
gConf_D0D1[ijk]*psi4;

   double adm_g_D0D2 =
gConf_D0D2[ijk]*psi4;

   double adm_g_D1D1 =
gConf_D1D1[ijk]*psi4;

   double adm_g_D1D2 =
gConf_D1D2[ijk]*psi4;

   double adm_g_D2D2 =
gConf_D2D2[ijk]*psi4;


   evo_adm_g_D0D0[ijk] = adm_g_D0D0;
   evo_adm_g_D0D1[ijk] = adm_g_D0D1;
   evo_adm_g_D0D2[ijk] = adm_g_D0D2;
   evo_adm_g_D1D1[ijk] = adm_g_D1D1;
   evo_adm_g_D1D2[ijk] = adm_g_D1D2;
   evo_adm_g_D2D2[ijk] = adm_g_D2D2;
   double Kdd_D0D0 =
adm_Kij_D0D0[ijk];

   double Kdd_D0D1 =
adm_Kij_D0D1[ijk];

   double Kdd_D0D2 =
adm_Kij_D0D2[ijk];

   double Kdd_D1D1 =
adm_Kij_D1D1[ijk];

   double Kdd_D1D2 =
adm_Kij_D1D2[ijk];

   double Kdd_D2D2 =
adm_Kij_D2D2[ijk];


   evo_adm_Kij_D0D0[ijk] = Kdd_D0D0;
   evo_adm_Kij_D0D1[ijk] = Kdd_D0D1;
   evo_adm_Kij_D0D2[ijk] = Kdd_D0D2;
   evo_adm_Kij_D1D1[ijk] = Kdd_D1D1;
   evo_adm_Kij_D1D2[ijk] = Kdd_D1D2;
   evo_adm_Kij_D2D2[ijk] = Kdd_D2D2;
  }
  if (IsItCovering(patch,"NS1"))
  {
  Physics_T *ns1 = init_physics(0,NS1);
  EoS_T *eos     = init_EoS(ns1);
  FOR_ALL_ijk
  {
  double psim4_ns1 =
pow(psi[ijk], -4);

  double grhd_v_ns1_U0 =
(W_U0[ijk] + psim4_ns1*(dphi_D0[ijk]*igConf_U0U0[ijk] + dphi_D1[ijk]*
igConf_U0U1[ijk] + dphi_D2[ijk]*igConf_U0U2[ijk]))/(enthalpy[ijk]*
evo_alpha[ijk]*u0[ijk]);

  double grhd_v_ns1_U1 =
(W_U1[ijk] + psim4_ns1*(dphi_D0[ijk]*igConf_U0U1[ijk] + dphi_D1[ijk]*
igConf_U1U1[ijk] + dphi_D2[ijk]*igConf_U1U2[ijk]))/(enthalpy[ijk]*
evo_alpha[ijk]*u0[ijk]);

  double grhd_v_ns1_U2 =
(W_U2[ijk] + psim4_ns1*(dphi_D0[ijk]*igConf_U0U2[ijk] + dphi_D1[ijk]*
igConf_U1U2[ijk] + dphi_D2[ijk]*igConf_U2U2[ijk]))/(enthalpy[ijk]*
evo_alpha[ijk]*u0[ijk]);


  evo_grhd_v_U0[ijk] = grhd_v_ns1_U0;
  evo_grhd_v_U1[ijk] = grhd_v_ns1_U1;
  evo_grhd_v_U2[ijk] = grhd_v_ns1_U2;
  eos->h = enthalpy[ijk];
  if(!isfinite(eos->h) || LSSEQL(eos->h,1.))
  {
    evo_grhd_rho[ijk]  = 0;
    evo_grhd_p[ijk]    = 0;
    evo_grhd_epsl[ijk] = 0;
  }
  else
  {
   evo_grhd_rho[ijk]  = eos->rest_mass_density(eos);
   evo_grhd_p[ijk]    = eos->pressure(eos);
   evo_grhd_epsl[ijk] = eos->specific_internal_energy(eos);
  }
  }
  free_physics(ns1);
  free_EoS(eos);
  }
  else if (IsItCovering(patch,"NS2"))
  {
  Physics_T *ns2 = init_physics(0,NS2);
  EoS_T *eos     = init_EoS(ns2);
  FOR_ALL_ijk
  {
  double psim4_ns2 =
pow(psi[ijk], -4);

  double grhd_v_ns2_U0 =
(W_U0[ijk] + psim4_ns2*(dphi_D0[ijk]*igConf_U0U0[ijk] + dphi_D1[ijk]*
igConf_U0U1[ijk] + dphi_D2[ijk]*igConf_U0U2[ijk]))/(enthalpy[ijk]*
evo_alpha[ijk]*u0[ijk]);

  double grhd_v_ns2_U1 =
(W_U1[ijk] + psim4_ns2*(dphi_D0[ijk]*igConf_U0U1[ijk] + dphi_D1[ijk]*
igConf_U1U1[ijk] + dphi_D2[ijk]*igConf_U1U2[ijk]))/(enthalpy[ijk]*
evo_alpha[ijk]*u0[ijk]);

  double grhd_v_ns2_U2 =
(W_U2[ijk] + psim4_ns2*(dphi_D0[ijk]*igConf_U0U2[ijk] + dphi_D1[ijk]*
igConf_U1U2[ijk] + dphi_D2[ijk]*igConf_U2U2[ijk]))/(enthalpy[ijk]*
evo_alpha[ijk]*u0[ijk]);


  evo_grhd_v_U0[ijk] = grhd_v_ns2_U0;
  evo_grhd_v_U1[ijk] = grhd_v_ns2_U1;
  evo_grhd_v_U2[ijk] = grhd_v_ns2_U2;
  eos->h = enthalpy[ijk];
  if(!isfinite(eos->h) || LSSEQL(eos->h,1.))
  {
    evo_grhd_rho[ijk]  = 0;
    evo_grhd_p[ijk]    = 0;
    evo_grhd_epsl[ijk] = 0;
  }
  else
  {
   evo_grhd_rho[ijk]  = eos->rest_mass_density(eos);
   evo_grhd_p[ijk]    = eos->pressure(eos);
   evo_grhd_epsl[ijk] = eos->specific_internal_energy(eos);
  }
  }
  free_physics(ns2);
  free_EoS(eos);
  }
  }
}
